<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reserva uso del espacio</title>
  <style>
   
  </style>
</head>
<body>
  <h2>Reservas Uso del Espacio</h2>
  <div id="spinner">Cargando disponibilidad...</div>
  <div class="container">
    <form id="reservaForm">
      <label>Nombre:</label>
      <input type="text" name="nombre" required>

      <label>Correo electrónico:</label>
      <input type="email" name="correo" required>

      <label>Celular:</label>
      <input type="text" name="celular" required>

      <label>Selecciona un día:</label>
      <div id="dias" class="days"></div>

      <label>Horario:</label>
      <select name="horario" id="horario" required></select>

      <button type="submit">Reservar</button>
    </form>
    <p id="mensaje"></p>
    <button id="otraReserva">Hacer otra reserva</button>
  </div>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxcK6wD9ESDvFMrefazi9I_6RkzGOOhdsJW808O_qdZANmGn_4ZEV7XbLSjdqs1rRjqTg/exec"; // Reemplaza con tu URL

    let disponibilidad = {};
    let diaSeleccionado = "";

    document.getElementById("spinner").style.display = "block";

    fetch(WEBAPP_URL + "?action=obtenerDisponibilidad")
      .then(res => res.json())
      .then(data => {
        disponibilidad = data;
        document.getElementById("spinner").style.display = "none";
        const diasDiv = document.getElementById("dias");
        const orden = ["Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
        orden.forEach(dia => {
          if (disponibilidad[dia]) {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.textContent = dia;
            btn.onclick = () => seleccionarDia(dia, btn);
            diasDiv.appendChild(btn);
          }
        });
      })
      .catch(error => {
        document.getElementById("spinner").style.display = "none";
        alert("⚠️ Error al cargar disponibilidad: " + error.message);
      });

    function seleccionarDia(dia, boton) {
      diaSeleccionado = dia;
      document.querySelectorAll("#dias button").forEach(b => b.classList.remove("active-day"));
      boton.classList.add("active-day");
      const select = document.getElementById("horario");
      select.innerHTML = "";
      disponibilidad[dia].forEach(h => {
        const opt = document.createElement("option");
        opt.value = h;
        opt.textContent = h;
        select.appendChild(opt);
      });
    }

    document.getElementById("reservaForm").addEventListener("submit", e => {
      e.preventDefault();

      if (!diaSeleccionado) {
        alert("Selecciona un día");
        return;
      }

      const formData = new FormData(e.target);
      formData.append("dia", diaSeleccionado);
      formData.append("action", "registrarReserva");

      document.getElementById("spinner").style.display = "block";

      fetch(WEBAPP_URL, {
        method: "POST",
        body: formData,
      })
        .then(res => res.text())
        .then(msg => {
          document.getElementById("spinner").style.display = "none";
          document.getElementById("mensaje").textContent = msg;
          document.getElementById("mensaje").style.display = "block";

          if (msg.includes("✅")) {
            document.getElementById("reservaForm").reset();
            document.getElementById("horario").innerHTML = "";
            document.querySelectorAll("#dias button").forEach(b => b.classList.remove("active-day"));
            document.getElementById("otraReserva").style.display = "block";
          }
        })
        .catch(error => {
          document.getElementById("spinner").style.display = "none";
          alert("❌ Error: " + error.message);
        });
    });

    document.getElementById("otraReserva").addEventListener("click", () => {
      document.getElementById("reservaForm").reset();
      document.getElementById("horario").innerHTML = "";
      document.querySelectorAll("#dias button").forEach(b => b.classList.remove("active-day"));
      document.getElementById("mensaje").style.display = "none";
      document.getElementById("otraReserva").style.display = "none";
      diaSeleccionado = "";
    });
  </script>
</body>
</html>

